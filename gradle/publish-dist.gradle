apply plugin: 'maven-publish'

publishing {
    publications {
        artifactoryDist(MavenPublication) {
            artifact(distTar) {
                classifier 'dist'
            }
        }
    }
    repositories {
        maven {
            url System.env.ARTIFACTORY_URL + System.env.ARTIFACTORY_DIST_SNAPSHOT_REPO
            credentials {
                username System.env.ARTIFACTORY_USERNAME
                password System.env.ARTIFACTORY_PASSWORD
            }
        }
    }
}

ext {
    releaseVersionRegex = /\d+\.\d+\.\d+(-alpha|-beta)?(\+\d{3})?/
}

publish.onlyIf {
    System.getenv('ARTIFACTORY_USERNAME') && System.getenv('ARTIFACTORY_PASSWORD') &&
            System.getenv('ARTIFACTORY_DIST_SNAPSHOT_REPO') && System.getenv('ARTIFACTORY_URL') &&
            !(project.version ==~ releaseVersionRegex)
}

publish.dependsOn 'distTar', 'build'
